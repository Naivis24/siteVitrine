{% extends "AppBundle::layout.html.twig" %}

{% block title %}
    Détails Marque
{% endblock %}

    {% block body %}

        <div class="container-fluid padding-start" id="section-start">


            <div class="container container-brand-detail-master">
            <div class="container-brand-detail">
                <div class="mask-brand">
                    <img class="img-fluid bandeau-marque" src="{{ asset('bundles/app/img/'~brand.getLifestyle()) }}"></div>
                <div class="container-brand-detail-text">
                    <div class="text-left"><a href="{{  path('marques')  }}"><span class="button-backb p-2"><img src=" {{ asset('bundles/app/img/angle-left.svg')}}" height="20px"/> Retour aux marques</span></a></div>
                    <h1>{{ brand.getName() }}</h1>
                    <p style="font-size:15px">{{ brand.getUrlwebsite() }}</p>
                    <p class="font-weight-bold p-4">{{ brand.getSlogan() }}</p>
                    <p>{{ brand.getDescription() }}</p>
                    <div class="d-flex justify-content-center p-4">
                        {% if brand.getUrlFac() != "" %}
                            <div class="icons-network"><a href="{{ brand.getUrlFac() }}" target="_blank"><i class="fab fa-facebook-f"></i></a></div>
                        {% endif %}
                        {% if brand.getUrlInsta() %}
                        <div class="icons-network"><a href="{{ brand.getUrlInsta() }}" target="_blank"><i class="fab fa-instagram"></i></a></div>
                    </div>
                </div>
                {% endif %}
            </div>
            </div>

            <div class="container">
                {% if brand.getLookBook() != "" %}
                    <a href="{{ asset('bundles/app/book/'~brand.getLookBook()) }}" target="_blank">LOOKBOOK</a>
                {% endif %}
            </div>
        </div>
        <div class="container-fluid sub-title-brands p-4">
            <h2>Catalogue des produits</h2></div>
        <div class="container-brand-detail">
            <div class="container-book-detail-text">
                <p>Vous souhaitez distribuer cette marque ?</p>
                <a href="{{ path('contact') }}"><span
                            class="button-fc p-2">Contactez-nous</span></a>
            </div>

            <div class="mask-book"><img class="img-fluid bandeau-marque" src="{{ asset('bundles/app/img/'~brand.getLifestyle2()) }}">
            </div>

        </div>

        <div class="container-fluid sub-title-brands p-4">
            <h2>Marques similaires</h2></div>
        <div class="container-fluid mt-4 mb-4">

                <!-- Début de l'algorithme -->
                <!--Initialisation des variables -->
                {% set styleBrand = brand.getStyle.toArray() %}
                {% set targetBrand = brand.getTarget.toArray() %}
                {% set categoryBrand = brand.getPrimaryCategory().toArray() %}
                {% set tab1 = [] %}
                {% set tab2 = [] %}
                {% set tab3 = [] %}
                {% set tab4 = [] %}
                {% set res1 = 0 %}
                {% set res2 = 0 %}
                {% set res3 = 0 %}
                {% set res4 = 0 %}
                {% set M1 = "" %}
                {% set M2 = "" %}
                {% set M3 = "" %}
                {% set M4 = "" %}
                {% for currentBrand in brands %}
                    {% set styleComp = currentBrand.getStyle.toArray() %}
                    {% set targetComp = currentBrand.getTarget.toArray() %}
                    {% set categoryComp = currentBrand.getPrimaryCategory().toArray() %}
                    {% set CurrentRes = 0 %}

                    <!-- Comparaison des styles -->

                    {% for styleC in styleComp %}
                        {% for styleB in styleBrand %}
                            {% if styleB.getLabel() == styleC.getLabel() %}
                                {% if brand.getName() != currentBrand.getName() %}
                                    {% set CurrentRes = CurrentRes + 3 %}
                                    {% if currentBrand.getName() not in tab1 %}
                                        {% set tab1 = tab1|merge([''~currentBrand.getName()]) %}
                                    {% endif %}
                                {% endif %}
                            {% endif %}
                        {% endfor %}
                    {% endfor %}

                    <!-- Comparaison des cibles -->

                    {% for targetC in targetComp %}
                        {% for targetB in targetBrand %}
                            {% if targetB.getLabel() == targetC.getLabel() %}
                                {% if brand.getName() != currentBrand.getName() %}
                                    {% set CurrentRes = CurrentRes + 4 %}
                                    {% if currentBrand.getName() not in tab2 %}
                                        {% set tab2 = tab2|merge([''~currentBrand.getName()]) %}
                                    {% endif %}
                                {% endif %}
                            {% endif %}
                        {% endfor %}
                    {% endfor %}

                    <!-- Comparaison des catégories -->

                    {% for categoryC in categoryComp %}
                        {% for categoryB in categoryBrand %}
                            {% if categoryB.getLabel() == categoryC.getLabel() %}
                                {% if brand.getName() != currentBrand.getName() %}
                                    {% set CurrentRes = CurrentRes + 1 %}
                                    {% if currentBrand.getName() not in tab3 %}
                                        {% set tab3 = tab3|merge([''~currentBrand.getName()]) %}
                                    {% endif %}
                                {% endif %}
                            {% endif %}
                        {% endfor %}
                    {% endfor %}

                    <!-- Comparaison de la gamme de prix -->

                    {% if brand.getPriceRange == currentBrand.getPriceRange %}
                        {% set CurrentRes = CurrentRes + 2 %}
                        {% if currentBrand.getName() not in tab4 %}
                            {% set tab4 = tab4|merge([''~currentBrand.getName()]) %}
                        {% endif %}
                    {% endif %}



                    <!-- On compte les points -->
                    {% if CurrentRes > res1 %}
                        {% set res4 = res3 %}
                        {% set res3 = res2 %}
                        {% set res2 = res1 %}
                        {% set M4 = M3 %}
                        {% set M3 = M2 %}
                        {% set M2 = M1 %}
                        {% set res1 = CurrentRes %}
                        {% set M1 = currentBrand %}
                    {% elseif CurrentRes > res2 %}
                        {% set res4 = res3 %}
                        {% set res3 = res2 %}
                        {% set M4 = M3 %}
                        {% set M3 = M2 %}
                        {% set res2 = CurrentRes %}
                        {% set M2 = currentBrand %}
                    {% elseif CurrentRes > res3 %}
                        {% set res4 = res3 %}
                        {% set M4 = M3 %}
                        {% set res3 = CurrentRes %}
                        {% set M3 = currentBrand %}
                    {% elseif CurrentRes > res4 %}
                        {% set res4 = CurrentRes %}
                        {% set M4 = currentBrand %}
                    {% endif %}

                {% endfor %}

                <!-- Affichage des résultats -->

                {% set tabRes = [M1, M2, M3, M4] %}
                <!-- Fin de l'algorithme -->
                <div class="row px-4">

                    {% for competitor in tabRes %}
                        {% set targets = competitor.getTarget.toArray() %}
                        {% set styles = competitor.getStyle.toArray() %}
                        {% set categories = competitor.getPrimaryCategory().toArray() %}
                    <div class="col-md-3 px-2 py-2">

                        <div class="card-marques shadow-sm">

                            <img class="img-fluid card-img" src="{{ asset('bundles/app/img/' ~ competitor.getPicture() ) }}">
                            <div class="container-img-brand">
                                <img src="{{ asset('bundles/app/img/' ~ competitor.getLogo()) }}" class="img-fluid">
                            </div>
                            <div class="container-hover-info">

                                <h5 class="card-title"> {{ competitor.getName() }} </h5>
                                {{ competitor.getSlogan() }}
                                <ul>
                                    <li>PAYS<br>
                                        <strong>{{ competitor.getCountry().getName() }}</strong></li>
                                    <li>CATÉGORIE<br>
                                        <strong> {% for categorie in categories %}
                                                {{ categorie.getLabel() }},
                                            {% endfor %}</strong>
                                    </li>
                                    <li>STYLE<br>
                                        <strong>  {% for style in styles %}
                                                {{ style.getLabel() }},
                                            {% endfor %}</strong>
                                    </li>
                                    <li>CIBLE<br>
                                        <strong id="cible"> {% for target in targets %}
                                                {{ target.getLabel() }},
                                            {% endfor %}</strong>
                                    </li>
                                    <li>GAMME DE PRIX<br>
                                        <strong>{{ competitor.getPriceRange().getLabel() }}</strong>
                                    </li>
                                </ul>
                            </div>
                            <div class="button-slide-brands"><a href="{{ path('details_marques', {'marque': competitor.getName()} ) }}" class="button-sb p-1">
                                    Découvrir la marque </a>
                            </div>

                        </div>
                </div>

                    {% endfor %}
                </div>
            </div>
        </div>
    {% endblock %}