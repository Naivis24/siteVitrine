{% extends "AppBundle::layout.html.twig" %}

{% block title %}
    French Select - La marque {{ brand.getName() }}
{% endblock %}

    {% block body %}

        <section class="container-fluid padding-start" id="section-start">

            <script>
                var temp = getCookie("target");
                console.log(temp);
            </script>


            <div class="container container-brand-detail-master mt-3">
            <div class="container-brand-detail">
                <div class="mask-brand">
                    <img class="img-fluid bandeau-marque" src="{{ asset('bundles/app/img/'~brand.getLifestyle()) }}"></div>
                <div class="container-brand-detail-text">
                    <div class="container-button-backb"><a href="{{  path('marques')  }}"><span class="button-backb p-2"><img src=" {{ asset('bundles/app/img/angle-left.svg')}}" height="20px"/> Retour aux marques</span></a></div>
                    <h1>{{ brand.getName() }}</h1>
                    <p style="font-size:15px"><a href="{{ brand.getUrlwebsite() }}" target="_blank">{{ brand.getUrlwebsite() }}</a></p>
                    <p class="font-weight-bold p-4">{{ brand.getSlogan() }}</p>
                    <p>{{ brand.getDescription() }}</p>
                    <div class="d-flex justify-content-center p-4">
                        {% if brand.getUrlFac() != "" %}
                            <div class="icons-network"><a href="{{ brand.getUrlFac() }}" target="_blank"><i class="fab fa-facebook-f"></i></a></div>
                        {% endif %}
                        {% if brand.getUrlInsta() != "" %}
                        <div class="icons-network"><a href="{{ brand.getUrlInsta() }}" target="_blank"><i class="fab fa-instagram"></i></a></div>
                        {% endif %}
                    </div>
                    <div>
                    {% if brand.getLookBook() != "" %}
                        <a href="{{ asset('bundles/app/book/'~brand.getLookBook()) }}" target="_blank">LOOKBOOK</a>
                    {% endif %}
                    </div>
                </div>
            </div>
            </div>
        </section>
        <section class="container-fluid sub-title-brands p-2">
            <h2>Catalogue des produits</h2>
        <div class="container-book-detail">
            <div class="container-book-detail-text">
                <h1>Demandez l'accès</h1>
                <p class="p-2">Pour avoir l'accès au catalogue des produits de cette marque, envoyez-nous une demande.</p>
                <a href="{{ path('contact') }}"><span
                            class="button-fc p-2">Contactez-nous</span></a>
            </div>

            <div class="mask-book"><img class="img-fluid bandeau-marque" src="{{ asset('bundles/app/img/'~brand.getLifestyle2()) }}">
            </div>
        </div>
        </section>

        <section class="container-fluid brands-competitor p-4">

            <h2>Les marques complémentaires</h2>

                <!-- Début de l'algorithme -->
                <!--Initialisation des variables -->
                {% set styleBrand = brand.getStyle.toArray() %}
                {% set categoryBrand = brand.getPrimaryCategory().toArray() %}
                {% set particularityBrand = brand.getFeature().toArray() %}
                {% set StargetBrand = brand.getTarget().toArray() %}
                {% set tab1 = [] %}
                {% set tab2 = [] %}
                {% set tab3 = [] %}
                {% set tab4 = [] %}
                {% set res1 = 0 %}
                {% set res2 = 0 %}
                {% set res3 = 0 %}
                {% set res4 = 0 %}
                {% set M1 = "" %}
                {% set M2 = "" %}
                {% set M3 = "" %}
                {% set M4 = "" %}
                {% for currentBrand in brands %}
                    {% set styleComp = currentBrand.getStyle.toArray() %}
                    {% set categoryComp = currentBrand.getPrimaryCategory().toArray() %}
                    {% set particularityComp = currentBrand.getFeature().toArray() %}
                    {% set StargetComp = currentBrand.getTarget().toArray() %}
                    {% set CurrentRes = 0 %}
                    {% set bool = true  %}


                    <!-- Comparaison des paricularités -->

                    {% for particularityC in particularityComp %}
                        {% for particularityB in particularityBrand %}
                            {% if particularityB.getLabel() == particularityC.getLabel() %}
                                {% if brand.getName() != currentBrand.getName() %}
                                    {% set CurrentRes = CurrentRes + 6 %}
                                {% endif %}
                            {% endif %}
                        {% endfor %}
                    {% endfor %}

                    <!-- Comparaison des cibles -->
                    {% if brand.getPrimarytarget() == currentBrand.getPrimarytarget() %}
                        {% set CurrentRes = CurrentRes + 5 %}
                    {% endif %}

                    <!-- Comparaison des styles -->

                    {% for styleC in styleComp %}
                        {% for styleB in styleBrand %}
                            {% if styleB.getLabel() == styleC.getLabel() %}
                                {% if brand.getName() != currentBrand.getName() %}
                                    {% set CurrentRes = CurrentRes + 4 %}
                                {% endif %}
                            {% endif %}
                        {% endfor %}
                    {% endfor %}

                    <!-- Comparaison de la gamme de prix -->

                    {% if brand.getPriceRange == currentBrand.getPriceRange %}
                        {% set CurrentRes = CurrentRes + 3 %}
                    {% endif %}

                    <!-- Comparaison des catégories -->

                    {% for categoryC in categoryComp %}
                        {% for categoryB in categoryBrand %}
                            {% if categoryB.getLabel() == categoryC.getLabel() %}
                                {% if brand.getName() != currentBrand.getName() %}
                                    {% set CurrentRes = CurrentRes + 2 %}
                                {% endif %}
                            {% endif %}
                        {% endfor %}
                    {% endfor %}

                    <!--Comparaison des cicles secondaires -->

                    {% for StargetC in StargetComp %}
                        {% for StargetB in StargetBrand %}
                            {% if StargetB.getLabel() == StargetC.getLabel() %}
                                {% if brand.getName() != currentBrand.getName() %}
                                    {% set CurrentRes = CurrentRes + 1 %}
                                {% endif %}
                            {% endif %}
                        {% endfor %}
                    {% endfor %}

                    <!-- Test Sponso -->
                    {% if currentBrand.getEstSponso() == 1 %}
                        {% set CurrentRes = CurrentRes * 1.25 %}
                    {% endif %}

                    <!-- On compte les points -->
                    {% if CurrentRes > res1 %}
                        {% set res4 = res3 %}
                        {% set res3 = res2 %}
                        {% set res2 = res1 %}
                        {% set M4 = M3 %}
                        {% set M3 = M2 %}
                        {% set M2 = M1 %}
                        {% set res1 = CurrentRes %}
                        {% set M1 = currentBrand %}
                    {% elseif CurrentRes > res2 %}
                        {% set res4 = res3 %}
                        {% set res3 = res2 %}
                        {% set M4 = M3 %}
                        {% set M3 = M2 %}
                        {% set res2 = CurrentRes %}
                        {% set M2 = currentBrand %}
                    {% elseif CurrentRes > res3 %}
                        {% set res4 = res3 %}
                        {% set M4 = M3 %}
                        {% set res3 = CurrentRes %}
                        {% set M3 = currentBrand %}
                    {% elseif CurrentRes > res4 %}
                        {% set res4 = CurrentRes %}
                        {% set M4 = currentBrand %}
                    {% elseif CurrentRes == res4 %}
                        {% if currentBrand.getDateInscription() > M4.getDateInscription() %}
                            {% set res4 = CurrentRes %}
                            {% set M4 = currentBrand %}
                        {% endif %}
                    {% endif %}
                {% endfor %}

                <!-- Affichage des résultats -->

                {% set tabRes = [M1, M2, M3, M4] %}
                <!-- Fin de l'algorithme -->

                {% set var1 = competing() %}
                {{ var1 }}
                <div class="row px-4">

                    {% for competitor in tabRes %}
                        {% set targets = competitor.getTarget.toArray() %}
                        {% set styles = competitor.getStyle.toArray() %}
                        {% set categories = competitor.getPrimaryCategory().toArray() %}
                    <div class="col-md-3 px-2 py-2">

                        <div class="card-marques shadow-sm">
                            {% set var = competitor.getPrimarytarget().getLabel() %}
                            {% if var == "Homme" %}
                                <img class="img-fluid card-img" src="{{ asset('bundles/app/img/' ~ competitor.getPictureHomme() ) }}">
                            {% elseif var == "Femme" %}
                                <img class="img-fluid card-img" src="{{ asset('bundles/app/img/' ~ competitor.getPictureFemme() ) }}">
                            {% else %}
                                <img class="img-fluid card-img" src="{{ asset('bundles/app/img/' ~ competitor.getPictureEnfant() ) }}">
                            {% endif %}
                            <div class="container-img-brand">
                                <img src="{{ asset('bundles/app/img/' ~ competitor.getLogo()) }}" class="img-fluid">
                            </div>
                            <div class="container-hover-info">

                                <h5 class="card-title"> {{ competitor.getName() }} </h5>
                                {{ competitor.getSlogan() }}
                                <ul>
                                    <li>PAYS<br>
                                        <strong>{{ competitor.getCountry().getName() }}</strong></li>
                                    <li>CATÉGORIE<br>
                                        <strong> {% for categorie in categories %}
                                                {{ categorie.getLabel() }},
                                            {% endfor %}</strong>
                                    </li>
                                    <li>STYLE<br>
                                        <strong>  {% for style in styles %}
                                                {{ style.getLabel() }},
                                            {% endfor %}</strong>
                                    </li>
                                    <li>CIBLE<br>
                                        <strong id="cible"> {% for target in targets %}
                                                {{ target.getLabel() }},
                                            {% endfor %}</strong>
                                    </li>
                                    <li>GAMME DE PRIX<br>
                                        <strong>{{ competitor.getPriceRange().getLabel() }}</strong>
                                    </li>
                                </ul>
                            </div>
                            <div class="button-slide-brands"><a href="{{ path('details_marques', {'marque': competitor.getName()} ) }}" class="button-sb p-1">
                                    Découvrir la marque </a>
                            </div>

                        </div>
                    </div>

                    {% endfor %}
                </div>
            <div class="container-btn text-center"><a href="{{ path('marques') }}" class="button-fh p-2">Découvrez toutes nos marques</a></div>
            </section>

    {% endblock %}